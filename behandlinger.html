<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Behandlinger | SOMI Klinikken Sandnes – finn riktig behandling</title>
  <meta name="description" content="Finn riktig behandling hos SOMI Klinikken i Sandnes. Søk eller filtrer på kategori, se kort forklaring og gå til detaljside. Book time online." />

  <link rel="stylesheet" href="/css/tokens.css" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/motion.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/hotfix.css" />

  <style>
    .page{ padding-top: calc(var(--header-h, 72px) + 26px); padding-bottom: 70px; }
    .kicker{ letter-spacing:.18em; font-size:12px; text-transform:uppercase; color:rgba(56,56,56,.62); }
    .h1-serif{ font-family: Georgia,"Times New Roman",serif; font-size: clamp(34px, 5vw, 54px); line-height:1.05; margin:10px 0 10px; }
    .lead{ max-width:74ch; color:rgba(56,56,56,.74); line-height:1.65; margin:0; }

    .toolbar{
      position: sticky;
      top: calc(var(--header-h, 72px) + 10px);
      z-index: 20;
      backdrop-filter: blur(10px);
      background: rgba(248,248,248,0.78);
      border: 1px solid rgba(56,56,56,0.12);
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.06);
      padding: 12px;
      margin-top: 16px;
    }
    .toolbar-grid{ display:grid; grid-template-columns: 1.2fr 0.8fr auto; gap:10px; align-items:center; }
    .input,.select{
      width:100%; border:1px solid rgba(56,56,56,0.16); background: rgba(255,255,255,0.86);
      border-radius:14px; padding:12px; font:inherit; outline:none;
    }
    .input:focus,.select:focus{ border-color: rgba(56,56,56,0.32); }
    .note{ margin-top:10px; color:rgba(56,56,56,.68); line-height:1.6; }

    .cards{ display:grid; gap:14px; margin-top: 14px; }
    .card{
      border-radius: 22px;
      background: rgba(255,255,255,0.76);
      border: 1px solid rgba(56,56,56,0.12);
      box-shadow: 0 14px 34px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    details.card > summary{
      cursor:pointer; list-style:none; padding:16px; display:flex; justify-content:space-between; gap:12px;
    }
    details.card > summary::-webkit-details-marker{ display:none; }
    .cat-title{ font-family: Georgia,"Times New Roman",serif; font-size:26px; line-height:1.1; margin:0; }
    .cat-desc{ margin:6px 0 0; color:rgba(56,56,56,.68); line-height:1.6; max-width:80ch; }
    .list{ border-top:1px solid rgba(56,56,56,0.10); padding:12px; display:grid; gap:10px; }

    .item{
      border:1px solid rgba(56,56,56,0.10);
      background: rgba(255,255,255,0.78);
      border-radius: 18px;
      padding: 14px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: start;
    }
    .item h3{ margin:0; font-size:16px; line-height:1.3; }
    .short{ margin-top:6px; color:rgba(56,56,56,.68); line-height:1.6; }
    .meta{ color:rgba(56,56,56,.70); font-variant-numeric: tabular-nums; white-space:nowrap; text-align:right; }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .pill{
      display:inline-flex; align-items:center; border:1px solid rgba(56,56,56,0.12);
      background: rgba(255,255,255,0.72); border-radius: 999px; padding: 6px 10px;
      color: rgba(56,56,56,.78); font-size: 12px;
    }
    .badges{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }

    .category-filters{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 16px 0 6px;
      padding:10px 12px;
      background: rgba(255,255,255,0.82);
      border:1px solid rgba(56,56,56,0.10);
      border-radius:16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.05);
    }
    .filter-chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(56,56,56,0.14);
      background: rgba(248,248,248,0.92);
      color: inherit;
      text-decoration:none;
      font-weight: 600;
      letter-spacing:0.01em;
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
    }
    .filter-chip:hover{
      transform: translateY(-1px);
      border-color: rgba(56,56,56,0.30);
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
    }
    .filter-chip:focus-visible{
      outline:2px solid rgba(56,56,56,0.45);
      outline-offset:2px;
    }

    @media (max-width: 860px){
      .toolbar-grid{ grid-template-columns: 1fr; }
      .item{ grid-template-columns: 1fr; }
      .meta{ text-align:left; }
    }
  </style>

  <script defer src="/js/includes.js"></script>
  <script defer src="/js/site.js"></script>
</head>

<body>
  <div data-include="/partials/header.html"></div>

  <main class="page">
    <div class="container">
      <header>
        <div class="kicker">Behandlinger</div>
        <h1 class="h1-serif">Finn riktig behandling</h1>
        <p class="lead">
          Velg kategori eller søk. Her får du en kort forklaring per behandling – detaljene ligger på egen side.
          Du kan alltid booke direkte via vår bookingside.
        </p>
      </header>

      <nav class="category-filters" aria-label="Snarveier til kategorier">
        <a href="#microblading" class="filter-chip">Microblading</a>
        <a href="#bryn-vipper" class="filter-chip">Bryn og vipper</a>
        <a href="#dermalogica" class="filter-chip">Dermalogica</a>
        <a href="#hudpleie" class="filter-chip">Hudpleie</a>
      </nav>

      <section class="toolbar" aria-label="Søk og filter">
        <div class="toolbar-grid">
          <input id="q" class="input" type="search" placeholder="Søk etter behandling…" autocomplete="off" />
          <select id="cat" class="select" aria-label="Velg kategori">
            <option value="all">Alle kategorier</option>
          </select>
          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <a class="btn btn--primary" href="/booking.html" data-booking-link>BOOK TIME</a>
            <a class="btn" href="/priser.html">Se priser</a>
          </div>
        </div>
        <div class="note" id="resultNote" aria-live="polite"></div>
      </section>

      <section class="cards" id="cards"></section>
    </div>
  </main>

  <div data-include="/partials/footer.html"></div>

  <script>
    (function(){
      const DATA_URL = "/data/treatments.json";
      const BOOKING_URL = (window.SOMI_CONFIG && window.SOMI_CONFIG.bookingUrl) || "/booking.html";
      const bookingTarget = (() => {
        const url = new URL(BOOKING_URL, window.location.origin);
        return url.origin === window.location.origin ? "" : ' target="_blank" rel="noopener"';
      })();

      const cardsEl = document.getElementById("cards");
      const qEl = document.getElementById("q");
      const catEl = document.getElementById("cat");
      const noteEl = document.getElementById("resultNote");

      const norm = (s) => (s || "").toLowerCase().trim();

      function itemMatches(item, term){
        if(!term) return true;
        const hay = norm(item.name + " " + (item.short||"") + " " + (item.tags||[]).join(" "));
        return hay.includes(term);
      }

      function render(data){
        // Fill category dropdown
        catEl.innerHTML = '<option value="all">Alle kategorier</option>' +
          data.categories.map(c => `<option value="${c.id}">${c.title}</option>`).join("");

        function build(){
          const term = norm(qEl.value);
          const selected = catEl.value;

          let visibleItems = 0;
          let visibleCats = 0;

          const html = data.categories.map(cat => {
            const inCat = (selected === "all") || (selected === cat.id);

            const items = (cat.items || []).filter(it => inCat && itemMatches(it, term));
            if(items.length === 0) return "";

            visibleCats++;
            visibleItems += items.length;

            const itemsHtml = items.map(it => {
              const badges = []
              if(it.popular) badges.push('<span class="pill">Populær</span>');
              (it.tags || []).slice(0,3).forEach(t => badges.push(`<span class="pill">${t}</span>`));

              return `
                <div class="item" data-name="${it.name}">
                  <div>
                    <h3>${it.name}</h3>
                    <div class="short">${it.short || "Kort beskrivelse kommer."}</div>
                    <div class="badges">${badges.join("")}</div>
                    <div class="actions">
                      <a class="btn" href="/behandlinger/${it.id}.html">Les mer</a>
                      <a class="btn btn--primary" href="${BOOKING_URL}"${bookingTarget}>Book</a>
                    </div>
                  </div>
                  <div class="meta">
                    <div><strong>${it.price || ""}</strong></div>
                    <div>${it.duration || ""}</div>
                  </div>
                </div>
              `;
            }).join("");

            return `
              <details class="card" open data-cat="${cat.id}" id="${cat.id}">
                <summary>
                  <div>
                    <div class="kicker">Kategori</div>
                    <h2 class="cat-title">${cat.title}</h2>
                    <p class="cat-desc">${cat.desc || ""}</p>
                  </div>
                  <div style="color:rgba(56,56,56,.55); font-size:14px;">Åpne/lukk</div>
                </summary>
                <div class="list">${itemsHtml}</div>
              </details>
            `;
          }).join("");

          cardsEl.innerHTML = html || `<div class="card" style="padding:16px;">Ingen treff. Prøv et annet søk.</div>`;
          noteEl.textContent = (!term && selected === "all")
            ? ""
            : `Viser ${visibleItems} behandling${visibleItems===1?"":"er"} i ${visibleCats} kategori${visibleCats===1?"":"er"}.`;
        }

        qEl.addEventListener("input", build);
        catEl.addEventListener("change", build);
        build();
      }

      fetch(DATA_URL, { cache: "no-store" })
        .then(r => r.json())
        .then(render)
        .catch(() => {
          cardsEl.innerHTML = `<div class="card" style="padding:16px;">
            Fant ikke <code>/data/treatments.json</code>. Opprett filen og last siden på nytt.
          </div>`;
        });
    })();
  </script>
</body>
</html>
